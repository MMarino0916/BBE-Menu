<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bobby Black Exclusive | Product</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#f5f5f5;
      --text:#111;
      --muted:#6b6b6b;
      --line:#e6e6e6;
      --card:#ffffff;
      --black:#111;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px 16px;
      background:#fff;
      border-bottom:1px solid var(--line);
    }
    .brand-logo{height:34px;width:auto;display:block}

    .wrap{
      max-width:1080px;
      margin:0 auto;
      padding:14px 14px 60px;
    }

    .crumb{
      font-size:12px;
      color:var(--muted);
      margin:10px 0 12px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .crumb a{
      color:var(--muted);
      text-decoration:none;
      font-weight:900;
    }
    .crumb a:hover{color:#000}

    .grid{
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap:16px;
      align-items:start;
    }

    .img-panel{
      background:#fff;
      border:1px solid var(--line);
      border-radius:10px;
      min-height:520px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .img-panel img{
      width:100%;
      height:auto;
      display:block;
      object-fit:contain;
      max-height:520px;
    }
    .img-placeholder{
      color:var(--muted);
      font-weight:900;
      padding:40px;
      text-align:center;
    }

    .info{
      background:#fff;
      border:1px solid var(--line);
      border-radius:10px;
      padding:14px;
    }

    /* ‚úÖ Only keep the right-side category badge (no THC badge) */
    .top-badges{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
      justify-content:flex-end;
    }
    .badge{
      font-size:12px;
      font-weight:900;
      letter-spacing:.6px;
      text-transform:uppercase;
      padding:8px 10px;
      border-radius:4px;
      border:1px solid var(--line);
      background:#fff;
    }
    .badge.type{
      background:#2a2f3a;
      color:#fff;
      border-color:#2a2f3a;
      min-width:140px;
      text-align:center;
    }

    .title{
      font-weight:900;
      letter-spacing:.5px;
      font-size:16px;
      text-transform:uppercase;
      margin:6px 0 4px;
    }
    .brandline{
      font-size:11px;
      text-transform:uppercase;
      color:var(--muted);
      letter-spacing:1px;
      margin-bottom:10px;
    }

    .ratingline{
      font-size:11px;
      color:var(--muted);
      margin:6px 0 10px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .stars{letter-spacing:1px;color:#bbb;font-size:12px}

    .size-row{display:flex;gap:10px;align-items:center;margin-top:6px}
    .size-select{
      flex:0 0 140px;
      border:1px solid var(--line);
      border-radius:3px;
      padding:12px 10px;
      font-weight:900;
      background:#fff;
    }

    .price{
      font-size:34px;
      font-weight:900;
      margin:12px 0 12px;
    }

    .buy-row{
      display:grid;
      grid-template-columns: 90px 1fr;
      gap:12px;
      align-items:stretch;
      margin-bottom:12px;
    }
    .qty-select{
      border:1px solid var(--line);
      border-radius:3px;
      padding:12px 10px;
      font-weight:900;
      background:#fff;
      width:100%;
    }
    .add-btn{
      border:0;
      border-radius:3px;
      background:#0e0e0e;
      color:#fff;
      font-weight:900;
      letter-spacing:1px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      text-transform:uppercase;
    }
    .add-btn:active{transform:translateY(1px)}
    .add-icon{
      width:14px;height:14px;display:inline-block;
      border:2px solid #fff;border-radius:3px;
      position:relative;
    }
    .add-icon:before{
      content:"";
      position:absolute;left:50%;top:50%;
      width:8px;height:2px;background:#fff;
      transform:translate(-50%,-50%);
    }
    .add-icon:after{
      content:"";
      position:absolute;left:50%;top:50%;
      width:2px;height:8px;background:#fff;
      transform:translate(-50%,-50%);
    }

    .subnote{
      font-size:12px;
      color:var(--muted);
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:6px;
      background:#fafafa;
      display:flex;
      gap:10px;
      align-items:flex-start;
      margin-bottom:10px;
    }

    hr.sep{border:0;border-top:1px solid var(--line);margin:14px 0}

    .about-title{
      font-size:12px;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:1px;
      color:#111;
      margin-bottom:6px;
    }
    .about-by{
      font-size:11px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:1px;
      margin-bottom:8px;
    }
    .about-text{
      font-size:12px;
      line-height:1.55;
      color:#333;
      white-space:pre-line;
    }

    .section-title{
      font-size:12px;
      font-weight:900;
      letter-spacing:1px;
      text-transform:uppercase;
      margin-bottom:6px;
    }

    .effects-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:8px;
    }
    .effect{
      border:1px solid var(--line);
      background:#fff;
      border-radius:4px;
      padding:10px 10px;
      font-size:12px;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.6px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .effect .icon{
      width:18px;height:18px;border:1px solid #ccc;border-radius:4px;
      display:inline-flex;align-items:center;justify-content:center;
      font-size:11px;color:#777;
    }

    /* Age gate */
    .age-gate{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.72);display:none;align-items:center;justify-content:center;padding:20px}
    .age-gate.show{display:flex}
    .age-card{background:#fff;max-width:420px;width:100%;border-radius:18px;padding:22px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .age-title{font-size:22px;font-weight:900;margin-bottom:8px}
    .age-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px}
    .age-btn{border:0;border-radius:999px;padding:12px;font-weight:900;cursor:pointer}
    .age-btn.yes{background:#111;color:#fff}
    .age-btn.no{background:#eee;color:#111}

    @media(max-width:900px){
      .grid{grid-template-columns:1fr}
      .img-panel{min-height:360px}
      .img-panel img{max-height:420px}
      .badge.type{min-width:120px}
    }
  </style>

  <script src="cart.js"></script>
</head>

<body>

  <!-- Age Gate -->
  <div id="ageGate" class="age-gate">
    <div class="age-card">
      <div class="age-title">21+ Only</div>
      <p>Please confirm you are 21 years of age or older.</p>
      <div class="age-actions">
        <button class="age-btn yes" id="ageYes">I‚Äôm 21+</button>
        <button class="age-btn no" id="ageNo">No</button>
      </div>
    </div>
  </div>

  <header>
    <img src="bobby-black.png" class="brand-logo" alt="Bobby Black Exclusive" />
  </header>

  <div class="wrap">
    <div class="crumb">
      <a href="index.html">‚Üê Back</a>
      <span id="crumbTrail">HOME ‚Ä¢ PRODUCT</span>
    </div>

    <div class="grid">
      <div class="img-panel" id="imgPanel">
        <div class="img-placeholder">No Image</div>
      </div>

      <div class="info">
        <div class="top-badges">
          <div class="badge type" id="typeBadge">‚Äî</div>
        </div>

        <div class="title" id="productTitle">Loading‚Ä¶</div>
        <div class="brandline" id="brandLine">‚Äî</div>

        <div class="ratingline">
          <span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
          <span id="ratingText">0</span>
        </div>

        <div class="size-row">
          <select id="sizeSelect" class="size-select"></select>
        </div>

        <div class="price" id="price">$0</div>

        <div class="buy-row">
          <select id="qtySelect" class="qty-select">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>

          <button id="addBtn" class="add-btn" type="button">
            <span class="add-icon" aria-hidden="true"></span>
            ADD TO CART
          </button>
        </div>

        <div class="subnote">
          <div style="font-weight:900;">üõí</div>
          <div>Cart is for <b>screenshot/sharing</b> only. No checkout or delivery on this site.</div>
        </div>

        <hr class="sep" />

        <div class="about-title" id="aboutTitle">ABOUT: ‚Äî</div>
        <div class="about-by" id="aboutBy">BY: ‚Äî</div>
        <div class="about-text" id="aboutText"></div>

        <hr class="sep" />

        <div class="section-title">EFFECTS</div>
        <div class="effects-grid" id="effectsGrid"></div>

        <!-- ‚úÖ Cannabinoids removed -->
      </div>
    </div>
  </div>

  <script>
    BBE_CART.mountCartPill();

    // Age gate
    (function(){
      const KEY="bbe_age_verified";
      const gate=document.getElementById("ageGate");
      if(localStorage.getItem(KEY)!=="true"){gate.classList.add("show")}
      document.getElementById("ageYes").onclick=()=>{localStorage.setItem(KEY,"true");gate.classList.remove("show")}
      document.getElementById("ageNo").onclick=()=>{window.location.href="https://www.google.com"}
    })();

    function money(n){
      if(n===null || n===undefined || n==="" || isNaN(Number(n))) return "N/A";
      return "$" + Number(n).toFixed(0);
    }
    function safeUpper(s){ return (s || "‚Äî").toString().toUpperCase(); }
    function getId(){ return new URLSearchParams(location.search).get("id"); }

    // ‚úÖ If product.html opened without ?id=..., send them back
    const id = getId();
    if(!id){
      window.location.replace("flower.html");
    }

    // ‚úÖ IMAGE FALLBACKS (includes your real id: crazzzy)
    const IMAGE_MAP = {
      "adl": "ADL.JPG",
      "cherry-candy": "CherryCandy.JPG",
      "chronic-candy": "ChronicCandy.JPG",
      "frosted-peaches": "FrostedPeaches.JPG",
      "jelly-fish": "JellyFish.JPG",
      "rainbow-belts": "RainbowBelts.JPG",
      "space-candy": "SpaceCandy.JPG",
      "sugar-shock": "SugarShock.JPG",
      "zaamatic": "Zaamatic.JPG",
      "blow-pop": "BlowPop.JPG",

      "crazzzy": "Crrazzy.JPG",   // ‚úÖ products.json id
      "crazzy": "Crrazzy.JPG",
      "crazzyy": "Crrazzy.JPG",

      "fruit-snacks": "FruitStripes.JPG",
      "ready-to-trap": "ReadytoTrap.JPG",
      "sherbert": "Sherbet.JPG",
      "verzace": "Verzace.JPG",
      "rosin-budder": "RosinBudder.JPG"
    };

    const NAME_MAP = {
      "crazzzy": "Crrazzy.JPG",
      "crazzyy": "Crrazzy.JPG",
      "crazzy": "Crrazzy.JPG",
      "adl": "ADL.JPG",
      "cherrycandy": "CherryCandy.JPG",
      "chroniccandy": "ChronicCandy.JPG",
      "frostedpeaches": "FrostedPeaches.JPG",
      "jellyfish": "JellyFish.JPG",
      "rainbowbelts": "RainbowBelts.JPG",
      "spacecandy": "SpaceCandy.JPG",
      "sugarshock": "SugarShock.JPG",
      "zaamatic": "Zaamatic.JPG",
      "blowpop": "BlowPop.JPG",
      "fruitsnacks": "FruitStripes.JPG",
      "readytotrap": "ReadytoTrap.JPG",
      "sherbert": "Sherbet.JPG",
      "verzace": "Verzace.JPG",
      "rosinbudder": "RosinBudder.JPG"
    };

    function normalizeKey(s){
      return String(s||"").toLowerCase().replace(/[^a-z0-9]/g,"");
    }

    function resolveImage(item){
      if(item.image && item.image.trim()) return item.image.trim();

      const byId = IMAGE_MAP[item.id];
      if(byId) return "images/" + byId;

      const byName = NAME_MAP[normalizeKey(item.name)];
      if(byName) return "images/" + byName;

      return "";
    }

    // UI refs
    const imgPanel = document.getElementById("imgPanel");
    const crumbTrail = document.getElementById("crumbTrail");
    const typeBadge = document.getElementById("typeBadge");
    const productTitle = document.getElementById("productTitle");
    const brandLine = document.getElementById("brandLine");
    const ratingText = document.getElementById("ratingText");
    const sizeSelect = document.getElementById("sizeSelect");
    const qtySelect = document.getElementById("qtySelect");
    const priceEl = document.getElementById("price");
    const addBtn = document.getElementById("addBtn");
    const aboutTitle = document.getElementById("aboutTitle");
    const aboutBy = document.getElementById("aboutBy");
    const aboutText = document.getElementById("aboutText");
    const effectsGrid = document.getElementById("effectsGrid");

    let currentItem = null;

    function buildSizeOptions(item){
      sizeSelect.innerHTML = "";

      if(item.category === "Flower"){
        const sizes = [
          { key:"g3_5", label:"3.5g" },
          { key:"g7",   label:"7g" },
          { key:"g14",  label:"14g" },
          { key:"g28",  label:"28g" }
        ];
        sizes.forEach(s=>{
          const available = item.availability?.[s.key] !== false;
          const p = item.prices?.[s.key];
          const opt = document.createElement("option");
          opt.value = s.key;
          opt.textContent = s.label;
          opt.disabled = !(available && p !== null && p !== undefined);
          sizeSelect.appendChild(opt);
        });
        const firstEnabled = Array.from(sizeSelect.options).find(o=>!o.disabled);
        if(firstEnabled) sizeSelect.value = firstEnabled.value;
      }
      else if(item.category === "Concentrates"){
        const opt = document.createElement("option");
        opt.value = "perGram";
        opt.textContent = "1g";
        opt.disabled = !(item.availability?.perGram !== false && item.prices?.perGram);
        sizeSelect.appendChild(opt);
        sizeSelect.value = "perGram";
      }
      else if(item.category === "Accessories"){
        const opt = document.createElement("option");
        opt.value = "single";
        opt.textContent = "Single";
        opt.disabled = !(item.availability?.single !== false && item.prices?.single);
        sizeSelect.appendChild(opt);
        sizeSelect.value = "single";
      }
      else{
        const opt = document.createElement("option");
        opt.value = "default";
        opt.textContent = "Item";
        sizeSelect.appendChild(opt);
      }
    }

    function getUnitPrice(item, sizeKey){
      if(item.category === "Flower") return item.prices?.[sizeKey];
      if(item.category === "Concentrates") return item.prices?.perGram;
      if(item.category === "Accessories") return item.prices?.single;
      return null;
    }

    function renderPrice(){
      if(!currentItem) return;
      const unit = getUnitPrice(currentItem, sizeSelect.value);
      priceEl.textContent = money(unit);
    }

    function renderEffects(item){
      effectsGrid.innerHTML = "";
      const effects = item.effects || [];
      const shown = effects.length ? effects : ["Calm","Happy","Relaxed","Uplifted"];
      shown.slice(0,6).forEach(e=>{
        const div = document.createElement("div");
        div.className = "effect";
        div.innerHTML = `<span class="icon">‚ú¶</span><span>${String(e).toUpperCase()}</span>`;
        effectsGrid.appendChild(div);
      });
    }

    function renderImage(item){
      const imgPath = resolveImage(item);
      if(!imgPath){
        imgPanel.innerHTML = `<div class="img-placeholder">No Image</div>`;
        return;
      }
      imgPanel.innerHTML = "";
      const img = document.createElement("img");
      img.src = imgPath;
      img.alt = item.name || "Product image";
      img.onerror = () => {
        imgPanel.innerHTML = `<div class="img-placeholder">No Image</div>`;
      };
      imgPanel.appendChild(img);
    }

    fetch("content/products.json", { cache:"no-store" })
      .then(r=>r.json())
      .then(data=>{
        const items = data.items || [];
        const item = items.find(x => x.id === id);

        if(!item){
          productTitle.textContent = "NOT FOUND";
          brandLine.textContent = "This product ID does not exist.";
          addBtn.disabled = true;
          addBtn.style.opacity = ".5";
          return;
        }

        currentItem = item;

        crumbTrail.textContent = `HOME ‚Ä¢ ${safeUpper(item.category)} ‚Ä¢ ${safeUpper(item.subcategory || "ITEM")}`;
        typeBadge.textContent = safeUpper(item.type || item.category);

        const brand = item.brand || "Bobby Black Exclusive";
        productTitle.textContent = `${safeUpper(brand)} | ${safeUpper(item.name)}`;
        brandLine.textContent = brand.toUpperCase();
        ratingText.textContent = "0";

        renderImage(item);

        aboutTitle.textContent = `ABOUT: ${safeUpper(brand)} | ${safeUpper(item.name)}`;
        aboutBy.textContent = `BY: ${brand.toUpperCase()}`;
        aboutText.textContent = item.description || "Description coming soon.";

        buildSizeOptions(item);
        renderPrice();
        sizeSelect.addEventListener("change", renderPrice);

        renderEffects(item);

        addBtn.onclick = () => {
          const qty = Number(qtySelect.value || 1);
          for(let i=0;i<qty;i++){
            BBE_CART.openAddFlow(item.id, "content/products.json");
          }
        };
      })
      .catch(err=>{
        productTitle.textContent = "ERROR";
        brandLine.textContent = "Could not load products.json.";
        console.error(err);
      });
  </script>

</body>
</html>
