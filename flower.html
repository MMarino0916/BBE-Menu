<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bobby Black Exclusive | Flower</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#fafafa;
      --text:#111;
      --muted:#666;
      --card:#fff;
      --border:#eaeaea;
      --shadow:0 10px 28px rgba(0,0,0,.10);
    }
    *{box-sizing:border-box}
    body{font-family:Arial,sans-serif;margin:0;background:var(--bg);color:var(--text)}
    header{text-align:center;padding:26px 16px 12px}
    .brand-logo{max-width:260px;width:72%;margin:0 auto;display:block}
    .subtitle{margin-top:10px;font-size:13px;letter-spacing:2px;text-transform:uppercase;color:var(--muted)}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 16px 46px}
    .back{display:inline-block;margin-bottom:16px;text-decoration:none;font-weight:900;color:#111}

    .group{margin-bottom:36px}
    .group-title{
      font-size:18px;font-weight:900;margin-bottom:10px;
      border-bottom:2px solid #111;display:inline-block;padding-bottom:4px
    }

    .item{
      background:var(--card);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      border-radius:14px;
      padding:14px;
      margin-top:12px;
      cursor:pointer;
      transition:transform .08s ease;
      display:flex;
      gap:14px;
      align-items:center;
    }
    .item:hover{transform:translateY(-2px)}

    .thumb{
      width:92px;height:92px;flex:0 0 92px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#f3f3f3;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .noimg{
      font-size:11px;
      color:var(--muted);
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:1px;
    }

    .item-main{flex:1 1 auto; min-width:0;}
    .item-name{font-weight:900;font-size:16px}
    .sale{color:#b00000;font-weight:900;margin-left:6px;font-size:13px}

    .prices{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px;font-size:13px}
    .price{background:#f4f4f4;border:1px solid #eee;border-radius:999px;padding:6px 10px}

    .actions-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{border:0;border-radius:999px;padding:10px 14px;font-weight:900;cursor:pointer}
    .btn.add{background:#111;color:#fff}
    .btn.view{background:#eee;color:#111}

    footer{text-align:center;padding:18px;font-size:14px;color:var(--muted)}

    /* Age gate */
    .age-gate{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.72);display:none;align-items:center;justify-content:center;padding:20px}
    .age-gate.show{display:flex}
    .age-card{background:#fff;max-width:420px;width:100%;border-radius:18px;padding:22px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .age-title{font-size:22px;font-weight:900;margin-bottom:8px}
    .age-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px}
    .age-btn{border:0;border-radius:999px;padding:12px;font-weight:900;cursor:pointer}
    .age-btn.yes{background:#111;color:#fff}
    .age-btn.no{background:#eee;color:#111}

    @media(max-width:700px){
      .brand-logo{width:86%}
      .thumb{width:78px;height:78px;flex-basis:78px}
    }
  </style>

  <script src="cart.js"></script>
</head>

<body>

<!-- Age Gate -->
<div id="ageGate" class="age-gate">
  <div class="age-card">
    <div class="age-title">21+ Only</div>
    <p>Please confirm you are 21 years of age or older.</p>
    <div class="age-actions">
      <button class="age-btn yes" id="ageYes">I‚Äôm 21+</button>
      <button class="age-btn no" id="ageNo">No</button>
    </div>
  </div>
</div>

<header>
  <img src="bobby-black.png" class="brand-logo" alt="Bobby Black Exclusive" />
  <div class="subtitle">Flower Menu</div>
</header>

<div class="wrap">
  <a href="index.html" class="back">‚Üê Back to Menu</a>
  <div id="menu"></div>
</div>

<footer>Updated Weekly ‚Ä¢ 21+</footer>

<script>
  // Cart pill
  BBE_CART.mountCartPill();

  // Age gate
  (function(){
    const KEY="bbe_age_verified";
    const gate=document.getElementById("ageGate");
    if(localStorage.getItem(KEY)!=="true"){gate.classList.add("show")}
    document.getElementById("ageYes").onclick=()=>{localStorage.setItem(KEY,"true");gate.classList.remove("show")}
    document.getElementById("ageNo").onclick=()=>{window.location.href="https://www.google.com"}
  })();

  function money(n){ return "$" + Number(n).toFixed(0); }
  function sizeLabel(k){ return k==="g3_5"?"3.5g":k==="g7"?"7g":k==="g14"?"14g":"28g"; }

  function showPriceOrNA(item, k){
    const available = item.availability?.[k] !== false;
    const price = item.prices?.[k];
    const hasPrice = price !== null && price !== undefined && price !== "";
    if(available && hasPrice) return money(price);
    return "N/A";
  }

  // Group order
  const GROUP_ORDER = ["BOBBY BLACK EXCLUSIVE","CA$$H RULE$","LOOSE LINEUP"];
  function groupSortKey(name){
    const idx = GROUP_ORDER.indexOf(name);
    return idx === -1 ? 999 : idx;
  }

  // Image filenames (must exist in /images/)
  const IMAGE_MAP = {
    "adl": "ADL.JPG",
    "cherry-candy": "CherryCandy.JPG",
    "chronic-candy": "ChronicCandy.JPG",
    "frosted-peaches": "FrostedPeaches.JPG",
    "jelly-fish": "JellyFish.JPG",
    "rainbow-belts": "RainbowBelts.JPG",
    "space-candy": "SpaceCandy.JPG",
    "sugar-shock": "SugarShock.JPG",
    "zaamatic": "Zaamatic.JPG",
    "blow-pop": "BlowPop.JPG",
    "crazzyy": "Crrazzy.JPG",      // ‚úÖ renamed
    "fruit-snacks": "FruitStripes.JPG",
    "ready-to-trap": "ReadytoTrap.JPG",
    "sherbert": "Sherbet.JPG",
    "verzace": "Verzace.JPG"
  };

  function getImageForItem(item){
    // Prefer explicit image path in products.json
    if(item.image && item.image.trim()) return item.image.trim();

    // Otherwise use map by id
    const file = IMAGE_MAP[item.id];
    if(!file) return "";
    return "images/" + file;
  }

  fetch("content/products.json",{cache:"no-store"})
    .then(r=>r.json())
    .then(data=>{
      // IMPORTANT: this page shows exactly what is in products.json for Flower.
      // To remove old items, delete them from products.json.
      const items=(data.items||[])
        .filter(i=>i.category==="Flower")
        .slice()
        .sort((a,b)=>{
          const ga=(a.subcategory||"Other");
          const gb=(b.subcategory||"Other");
          const ka=groupSortKey(ga);
          const kb=groupSortKey(gb);
          if(ka!==kb) return ka-kb;
          if(ga!==gb) return ga.localeCompare(gb);
          return (a.name||"").localeCompare(b.name||"");
        });

      const groups={};
      items.forEach(i=>{
        const key=i.subcategory||"Other";
        if(!groups[key]) groups[key]=[];
        groups[key].push(i);
      });

      const container=document.getElementById("menu");
      container.innerHTML = "";

      const groupNames = [
        ...GROUP_ORDER.filter(g=>groups[g]),
        ...Object.keys(groups).filter(g=>!GROUP_ORDER.includes(g)).sort()
      ];

      groupNames.forEach(groupName=>{
        const group=document.createElement("div");
        group.className="group";

        const title=document.createElement("div");
        title.className="group-title";
        title.textContent=groupName;
        group.appendChild(title);

        groups[groupName].forEach(item=>{
          const div=document.createElement("div");
          div.className="item";
          div.onclick=()=>location.href="product.html?id="+encodeURIComponent(item.id);

          // Thumbnail
          const thumb=document.createElement("div");
          thumb.className="thumb";
          const imgPath = getImageForItem(item);

          if(imgPath){
            const img=document.createElement("img");
            img.src = imgPath;
            img.alt = item.name;
            img.onerror = () => {
              thumb.innerHTML = "<div class='noimg'>No Image</div>";
            };
            thumb.appendChild(img);
          } else {
            thumb.innerHTML = "<div class='noimg'>No Image</div>";
          }

          div.appendChild(thumb);

          // Main
          const main=document.createElement("div");
          main.className="item-main";

          const name=document.createElement("div");
          name.className="item-name";
          name.textContent=item.name;

          if(item.sale){
            const s=document.createElement("span");
            s.className="sale";
            s.textContent="üö® SALE";
            name.appendChild(s);
          }

          main.appendChild(name);

          const prices=document.createElement("div");
          prices.className="prices";
          ["g3_5","g7","g14","g28"].forEach(k=>{
            const p=document.createElement("span");
            p.className="price";
            p.textContent=sizeLabel(k)+": "+showPriceOrNA(item, k);
            prices.appendChild(p);
          });

          main.appendChild(prices);

          // Actions
          const actions=document.createElement("div");
          actions.className="actions-row";

          const addBtn=document.createElement("button");
          addBtn.className="btn add";
          addBtn.type="button";
          addBtn.textContent="Add";
          addBtn.onclick=(e)=>{
            e.stopPropagation();
            BBE_CART.openAddFlow(item.id, "content/products.json");
          };

          const viewBtn=document.createElement("button");
          viewBtn.className="btn view";
          viewBtn.type="button";
          viewBtn.textContent="View";
          viewBtn.onclick=(e)=>{
            e.stopPropagation();
            location.href="product.html?id="+encodeURIComponent(item.id);
          };

          actions.appendChild(addBtn);
          actions.appendChild(viewBtn);
          main.appendChild(actions);

          div.appendChild(main);
          group.appendChild(div);
        });

        container.appendChild(group);
      });
    })
    .catch(err=>{
      document.getElementById("menu").innerHTML =
        "<div style='color:#b00000;font-weight:900'>Error loading products.json</div>";
      console.error(err);
    });
</script>

</body>
</html>
