<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bobby Black Exclusive | Flower</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#fafafa;
      --text:#111;
      --muted:#666;
      --card:#fff;
      --border:rgba(0,0,0,0.10);
      --shadow:0 10px 28px rgba(0,0,0,.10);

      /* Luxury accents */
      --gold:#D4AF37;
      --gold-soft:rgba(212,175,55,0.35);
      --black:#0E0E0E;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,sans-serif;margin:0;background:var(--bg);color:var(--text)}

    /* ‚úÖ Full-width black header bar */
    .site-header{
      background:#000;
      width:100%;
      text-align:center;
      padding:28px 16px 22px;
      border-bottom:1px solid var(--gold-soft);
    }
    .brand-logo{
      max-width:260px;
      width:72%;
      margin:0 auto;
      display:block;
    }
    .subtitle{
      margin-top:10px;
      font-size:12px;
      letter-spacing:3px;
      text-transform:uppercase;
      color:var(--gold);
    }

    .wrap{max-width:1100px;margin:0 auto;padding:16px 16px 26px}

    .back{
      display:inline-block;
      margin-bottom:16px;
      text-decoration:none;
      font-weight:900;
      color:#111;
      border-bottom:1px solid transparent;
      transition:color .18s ease, border-color .18s ease;
    }
    .back:hover{color:var(--gold);border-color:var(--gold)}

    .group{margin-bottom:36px}
    .group-title{
      font-size:18px;
      font-weight:900;
      margin-bottom:10px;
      border-bottom:2px solid #111;
      display:inline-block;
      padding-bottom:4px
    }

    .item{
      background:var(--card);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      border-radius:14px;
      padding:14px;
      margin-top:12px;
      cursor:pointer;
      transition:transform .08s ease, border-color .18s ease;
      display:flex;
      gap:14px;
      align-items:center;
    }
    .item:hover{
      transform:translateY(-2px);
      border-color:var(--gold-soft);
    }

    .thumb{
      width:92px;height:92px;flex:0 0 92px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#f3f3f3;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      transition:border-color .18s ease;
    }
    .item:hover .thumb{border-color:var(--gold-soft)}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .noimg{
      font-size:11px;
      color:var(--muted);
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:1px;
    }

    .item-main{flex:1 1 auto; min-width:0;}
    .item-name{font-weight:900;font-size:16px}
    .sale{color:#b00000;font-weight:900;margin-left:6px;font-size:13px}

    .meta{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    .prices{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;font-size:13px}
    .price{
      background:#f4f4f4;
      border:1px solid #eee;
      border-radius:999px;
      padding:6px 10px;
      transition:border-color .18s ease;
      white-space:nowrap;
    }
    .price.na{opacity:.55}
    .item:hover .price{border-color:var(--gold-soft)}

    .actions-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      border:1px solid rgba(0,0,0,0.12);
      border-radius:999px;
      padding:10px 14px;
      font-weight:900;
      cursor:pointer;
      background:#fff;
      transition:all .18s ease;
    }

    .btn.add{
      background:var(--black);
      color:#fff;
      border-color:var(--black);
    }
    .btn.add:hover{
      background:#fff;
      color:var(--black);
      border-color:var(--gold);
    }

    .btn.view{
      background:#eee;
      color:#111;
      border-color:#eee;
    }
    .btn.view:hover{
      background:#fff;
      color:var(--gold);
      border-color:var(--gold);
    }

    footer{
      text-align:center;
      padding:18px 14px 28px;
      font-size:11px;
      color:#777;
    }

    /* ‚úÖ Age gate */
    .age-gate{
      position:fixed;inset:0;z-index:9999;
      background:rgba(0,0,0,.72);
      display:none;align-items:center;justify-content:center;padding:20px
    }
    .age-gate.show{display:flex}
    .age-card{
      background:#fff;
      max-width:460px;width:100%;
      border-radius:18px;
      padding:22px;
      text-align:center;
      box-shadow:0 20px 60px rgba(0,0,0,.35);
      border:1px solid rgba(0,0,0,0.12);
    }
    .age-logo{
      width:180px;
      max-width:70%;
      height:auto;
      display:block;
      margin:0 auto 10px;
    }
    .age-title{font-size:22px;font-weight:900;margin-bottom:8px}
    .age-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px}
    .age-btn{
      border:1px solid rgba(0,0,0,0.15);
      border-radius:999px;
      padding:12px;
      font-weight:900;
      cursor:pointer;
      background:#fff;
      transition:all .18s ease;
    }
    .age-btn.yes{
      background:var(--black);
      color:#fff;
      border-color:var(--black);
    }
    .age-btn.yes:hover{
      background:#fff;
      color:var(--black);
      border-color:var(--gold);
    }
    .age-btn.no{
      background:#eee;color:#111;border-color:#eee;
    }
    .age-btn.no:hover{
      border-color:var(--gold);
      color:var(--gold);
      background:#fff;
    }
    .age-sub{font-size:12px;color:#666;line-height:1.5;margin:10px 0 0}

    @media(max-width:700px){
      .brand-logo{width:86%}
      .thumb{width:78px;height:78px;flex-basis:78px}
    }
  </style>

  <script src="cart.js"></script>
</head>

<body>

  <!-- Age Gate -->
  <div id="ageGate" class="age-gate">
    <div class="age-card">
      <img src="images/BBE.png" class="age-logo" alt="Bobby Black Exclusive" />
      <div class="age-title">21+ Only</div>
      <p>Please confirm you are 21 years of age or older.</p>
      <div class="age-actions">
        <button class="age-btn yes" id="ageYes">I‚Äôm 21+</button>
        <button class="age-btn no" id="ageNo">No</button>
      </div>
      <p class="age-sub">
        All products, pricing, and descriptions are provided for reference only.
        No transactions, checkout, or delivery occur through this site.
      </p>
    </div>
  </div>

  <!-- ‚úÖ Black header -->
  <header class="site-header">
    <!-- Category page logo -->
    <img src="images/Bobbyb.png" class="brand-logo" alt="Bobby Black Exclusive" />
    <div class="subtitle">Flower Menu</div>
  </header>

  <div class="wrap">
    <a href="index.html" class="back">‚Üê Back to Menu</a>
    <div id="menu"></div>
  </div>

  <footer>
    All products, pricing, and descriptions are provided for reference only.
    No transactions, checkout, or delivery occur through this site. ‚Ä¢ 21+
  </footer>

  <script>
    BBE_CART.mountCartPill();

    // Age gate
    (function(){
      const KEY="bbe_age_verified";
      const gate=document.getElementById("ageGate");
      if(localStorage.getItem(KEY)!=="true"){gate.classList.add("show")}
      document.getElementById("ageYes").onclick=()=>{localStorage.setItem(KEY,"true");gate.classList.remove("show")}
      document.getElementById("ageNo").onclick=()=>{window.location.href="https://www.google.com"}
    })();

    function money(n){
      const num = Number(n);
      if(!isFinite(num)) return "N/A";
      return "$" + num.toFixed(0);
    }
    function sizeLabel(k){ return k==="g3_5"?"3.5g":k==="g7"?"7g":k==="g14"?"14g":"28g"; }

    function showPriceOrNA(item, k){
      const available = item.availability?.[k] !== false;
      const price = item.prices?.[k];
      const hasPrice = price !== null && price !== undefined && price !== "";
      if(available && hasPrice) return money(price);
      return "N/A";
    }

    const GROUP_ORDER = ["BOBBY BLACK EXCLUSIVE","CA$$H RULE$","LOOSE LINEUP"];

    // Hide items that are no longer on the menu
    const HIDDEN_IDS = new Set([
      "sherbanger-22",
      "super-lemon-cherry"
    ]);

    // Image filenames (must exist in /images/)
    const IMAGE_MAP = {
      "adl": "ADL.JPG",
      "cherry-candy": "CherryCandy.JPG",
      "chronic-candy": "ChronicCandy.JPG",
      "frosted-peaches": "FrostedPeaches.JPG",
      "jelly-fish": "JellyFish.JPG",
      "rainbow-belts": "RainbowBelts.JPG",
      "space-candy": "SpaceCandy.JPG",
      "sugar-shock": "SugarShock.JPG",
      "zaamatic": "Zaamatic.JPG",
      "blow-pop": "BlowPop.JPG",
      "crazzzy": "Crrazzy.JPG",
      "fruit-snacks": "FruitStripes.JPG",
      "ready-to-trap": "ReadytoTrap.JPG",
      "sherbert": "Sherbet.JPG",
      "verzace": "Verzace.JPG"
    };

    // ‚úÖ FIXED: map *normalized names* to the right image file
    const NAME_MAP = {
      // Crrazzy variants
      "crrazzy": "Crrazzy.JPG",
      "crazzy": "Crrazzy.JPG",
      "crazzyy": "Crrazzy.JPG",
      "crazzzy": "Crrazzy.JPG",

      "adl": "ADL.JPG",
      "cherrycandy": "CherryCandy.JPG",
      "chroniccandy": "ChronicCandy.JPG",
      "frostedpeaches": "FrostedPeaches.JPG",
      "jellyfish": "JellyFish.JPG",
      "rainbowbelts": "RainbowBelts.JPG",
      "spacecandy": "SpaceCandy.JPG",
      "sugarshock": "SugarShock.JPG",
      "zaamatic": "Zaamatic.JPG",
      "blowpop": "BlowPop.JPG",
      "fruitsnacks": "FruitStripes.JPG",
      "readytotrap": "ReadytoTrap.JPG",
      "sherbert": "Sherbet.JPG",
      "verzace": "Verzace.JPG"
    };

    function normalizeKey(s){
      return String(s||"").toLowerCase().replace(/[^a-z0-9]/g,"");
    }

    function getImageForItem(item){
      // explicit image path in JSON wins
      if(item.image && String(item.image).trim()) return String(item.image).trim();

      // by id
      const byId = IMAGE_MAP[item.id];
      if(byId) return "images/" + byId;

      // by normalized name
      const byName = NAME_MAP[normalizeKey(item.name)];
      if(byName) return "images/" + byName;

      return "";
    }

    function openProduct(id){
      location.href = "product.html?id=" + encodeURIComponent(id);
    }

    // Optional: show a short meta line if fields exist in products.json
    function buildMetaLine(item){
      const bits = [];
      if(item.type) bits.push(item.type);              // e.g., Indica/Hybrid/Sativa
      if(item.brand) bits.push(item.brand);            // e.g., brand/line
      if(item.thc) bits.push("THC " + item.thc);       // e.g., "THC 28%"
      if(item.note) bits.push(item.note);              // short note
      if(item.description && !item.note) {
        const d = String(item.description).trim();
        if(d) bits.push(d.length > 70 ? d.slice(0, 70) + "‚Ä¶" : d);
      }
      return bits.filter(Boolean).join(" ‚Ä¢ ");
    }

    fetch("content/products.json",{cache:"no-store"})
      .then(r=>r.json())
      .then(data=>{
        const items=(data.items||[])
          .filter(i => i.category === "Flower")
          .filter(i => !HIDDEN_IDS.has(i.id))
          .slice()
          .sort((a,b)=>{
            const ga=(a.subcategory||"Other");
            const gb=(b.subcategory||"Other");
            const ka=GROUP_ORDER.indexOf(ga);
            const kb=GROUP_ORDER.indexOf(gb);
            const ska = (ka === -1 ? 999 : ka);
            const skb = (kb === -1 ? 999 : kb);
            if(ska !== skb) return ska - skb;
            if(ga !== gb) return ga.localeCompare(gb);
            return (a.name||"").localeCompare(b.name||"");
          });

        const groups={};
        items.forEach(i=>{
          const key=i.subcategory||"Other";
          if(!groups[key]) groups[key]=[];
          groups[key].push(i);
        });

        const container=document.getElementById("menu");
        container.innerHTML = "";

        const groupNames = [
          ...GROUP_ORDER.filter(g=>groups[g]),
          ...Object.keys(groups).filter(g=>!GROUP_ORDER.includes(g)).sort()
        ];

        groupNames.forEach(groupName=>{
          const group=document.createElement("div");
          group.className="group";

          const title=document.createElement("div");
          title.className="group-title";
          title.textContent=groupName;
          group.appendChild(title);

          groups[groupName].forEach(item=>{
            const div=document.createElement("div");
            div.className="item";
            div.onclick=()=>openProduct(item.id);

            const thumb=document.createElement("div");
            thumb.className="thumb";
            const imgPath = getImageForItem(item);

            if(imgPath){
              const img=document.createElement("img");
              img.src = imgPath;
              img.alt = item.name;
              img.loading = "lazy";
              img.onerror = () => { thumb.innerHTML = "<div class='noimg'>No Image</div>"; };
              thumb.appendChild(img);
            } else {
              thumb.innerHTML = "<div class='noimg'>No Image</div>";
            }

            div.appendChild(thumb);

            const main=document.createElement("div");
            main.className="item-main";

            const name=document.createElement("div");
            name.className="item-name";
            name.textContent=item.name;

            if(item.sale){
              const s=document.createElement("span");
              s.className="sale";
              s.textContent="üö® SALE";
              name.appendChild(s);
            }

            main.appendChild(name);

            const metaText = buildMetaLine(item);
            if(metaText){
              const meta=document.createElement("div");
              meta.className="meta";
              meta.textContent = metaText;
              main.appendChild(meta);
            }

            const prices=document.createElement("div");
            prices.className="prices";
            ["g3_5","g7","g14","g28"].forEach(k=>{
              const label = sizeLabel(k);
              const val = showPriceOrNA(item, k);

              const p=document.createElement("span");
              p.className="price" + (val === "N/A" ? " na" : "");
              p.textContent = label + ": " + val;
              prices.appendChild(p);
            });
            main.appendChild(prices);

            const actions=document.createElement("div");
            actions.className="actions-row";

            const addBtn=document.createElement("button");
            addBtn.className="btn add";
            addBtn.type="button";
            addBtn.textContent="Add";
            addBtn.onclick=(e)=>{
              e.stopPropagation();
              BBE_CART.openAddFlow(item.id, "content/products.json");
            };

            const viewBtn=document.createElement("button");
            viewBtn.className="btn view";
            viewBtn.type="button";
            viewBtn.textContent="View";
            viewBtn.onclick=(e)=>{
              e.stopPropagation();
              openProduct(item.id);
            };

            actions.appendChild(addBtn);
            actions.appendChild(viewBtn);
            main.appendChild(actions);

            div.appendChild(main);
            group.appendChild(div);
          });

          container.appendChild(group);
        });
      })
      .catch(err=>{
        document.getElementById("menu").innerHTML =
          "<div style='color:#b00000;font-weight:900'>Error loading products.json</div>";
        console.error(err);
      });
  </script>

</body>
</html>
